name: Cloudflare DNS

on:
  push:
    branches:
      - main  # Adjust the branch name as needed
  workflow_dispatch:

jobs:
  update-dns:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Check Existing DNS Record
      id: check-dns
      run: |
        # Your existing code for checking DNS record

    - name: Send Email if DNS Exists
      if: steps.check-dns.outputs.dns-record != '[]'
      run: |
        python python-script/send_email.py

    - name: Create Cloudflare DNS Record
      run: |
        # Replace placeholders with your actual values
        CF_API_TOKEN="HsoabgfSbNQVeHpg30hI14GOo8mZLixzk_7HhJY8"
        ZONE_ID="38b42bfdb42dbe301b6b1a27b86ac939"
        RECORD_NAME="saad.karazo.com"
        RECORD_TYPE="A"
        RECORD_CONTENT="198.51.100.4"  # Replace with your actual IP address
        TTL=3600

        # Construct the API URL
        API_URL="https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records"

        # Create the DNS record using curl
        curl -X POST "$API_URL" \
             -H "Authorization: Bearer $CF_API_TOKEN" \
             -H "Content-Type: application/json" \
             --data '{
               "type": "'$RECORD_TYPE'",
               "name": "'$RECORD_NAME'",
               "content": "'$RECORD_CONTENT'",
               "ttl": '$TTL'
             }'
      env:
        CF_API_TOKEN: ${{ secrets.BAHI_KA_TOKEN }}  # Access token stored as a secret
